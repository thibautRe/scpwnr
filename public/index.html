<!DOCTYPE html>
<html>
<head>
  <title>Soundcloud Pwnr*</title>
  <link rel="stylesheet" type="text/css" href="/styles/app.css">
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700' rel='stylesheet' type='text/css'>
</head>
<body>

<h1>Sc Pwnr*</h1>
<h2>Soundcloud's home-made, powerful, and fresh Pwnr.</h2>

<form class="form--main js-form--main" action="/song">
  <input class="form-square form-url" name="url"/>
  <button class="form-square form-submit" type="submit">Convertir</button>
</form>

<span class="song-type js-song-type"></span>

<script type="text/javascript" src="/vendor/zepto/zepto.js"></script>
<script type="text/javascript" src="/scripts/scpwnr-client.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  var io = io.connect();

  var message = function(mess) {
    $('body').append('<div>' + mess + '</div>');
  };

  // Listen for the talk event.
  io.on('conv-begin', function(data) {
    message('Conversion begin : ' + data.id);
  });
  io.on('conv-finish', function(data) {
    message('Conversion finished (ID: ' + data.id + ')');
  });
  io.on('conv-error', function(data) {
    message('Conversion error : ' + data.consoleMsg.stdout);
  });

  var requestForm = $('.js-form--main');

  // on submit
  requestForm.submit(function() {
    var url = getCleanedUrl(requestForm.serializeArray()[0].value);

    if (url === undefined) {
      message('URL unrecognized');
      return false;
    }

    $('.js-song-type').text(getUrlType(url));

    // Disable the form
    $('js-form--main input').attr('disabled', 'true');

    io.emit('conv-request', {
      url: url,
      type: getUrlType(url)
    });

    return false;
  });

</script>
</body>